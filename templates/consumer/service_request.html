{% extends 'base.html' %}

{% block head %}
<title>Add Service Request</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
{% endblock head %}

{% block body %}

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      
      <div class="card shadow border-0">
        <div class="card-header bg-primary text-white text-center py-3">
          <h3 class="fw-bold mb-0">Request a Service</h3>
          <p class="mb-0 text-white-50">Fill in the details to find a provider near you</p>
        </div>
        
        <div class="card-body p-4">
          <form class="row g-3" method="POST" action="{{url_for('add_service_request')}}">
            
            <div class="col-md-8">
              <label for="service_title" class="form-label fw-bold">Service Title</label>
              <input name="service_title" type="text" class="form-control" id="service_title" placeholder="e.g. Leaking Tap Repair" required>
            </div>
            
            <div class="col-md-4">
              <label for="service_type" class="form-label fw-bold">Service Type</label>
              <select name="service_type" id="service_type" class="form-select" required>
                <option value="" selected disabled>Choose...</option>
                <option value="Electrician">Electrician</option>
                <option value="Plumber">Plumber</option>
                <option value="Carpenter">Carpenter</option>
                <option value="Teacher">Teacher</option>
                <option value="Mason">Mason</option>
                <option value="Technician">Technician</option>
                <option value="Welder">Welder</option>
                <option value="Maid">Maid</option>
                <option value="Labour">Labour</option>
                <option value="Barber">Barber</option>
                <option value="General Physician">General Physician</option>
                <option value="Consultant">Consultant</option>
                <option value="Priest">Priest</option>
                <option value="House Cleaning">House Cleaning</option>
                <option value="Chef">Chef</option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="budget" class="form-label fw-bold">Estimated Budget</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input name="budget" type="number" class="form-control" id="budget" placeholder="100" min="0" required>
              </div>
            </div>

            <div class="col-12">
              <label for="service_desc" class="form-label fw-bold">Description</label>
              <textarea name="service_desc" class="form-control" id="service_desc" rows="3"
                placeholder="Describe the issue in detail..." required></textarea>
            </div>

            <div class="col-12">
              <label class="form-label fw-bold">Service Location</label>
              <div id="map" style="height: 300px; border-radius: 8px; border: 1px solid #dee2e6;"></div>
              <div class="form-text text-center mt-2">
                <i class="bi bi-geo-alt-fill"></i> Click on the map to pinpoint the location.
              </div>
              
              <input type="hidden" name="latitude" id="latitude" required>
              <input type="hidden" name="longitude" id="longitude" required>
            </div>

            <div class="col-12 d-flex justify-content-between align-items-center mt-4">
              <a href="{{url_for('consumer_dashboard')}}" class="btn btn-outline-secondary px-4">Cancel</a>
              <button type="submit" class="btn btn-primary btn-lg px-5">Submit Request</button>
            </div>
            
          </form>
        </div>
      </div>
      
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  // Default center (India)
  var map = L.map('map').setView([22.9734, 78.6569], 5);

  // Tile layer
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);

  var marker;

  // Click to select location
  map.on('click', function (e) {
    var lat = e.latlng.lat;
    var lng = e.latlng.lng;

    if (marker) {
      map.removeLayer(marker);
    }

    marker = L.marker([lat, lng]).addTo(map);

    // Store values in hidden inputs
    document.getElementById('latitude').value = lat;
    document.getElementById('longitude').value = lng;
  });

  // Auto-detect user location
  map.locate({ setView: true, maxZoom: 16 });

  map.on('locationfound', function (e) {
    if (!marker) {
      marker = L.marker(e.latlng).addTo(map);
      document.getElementById('latitude').value = e.latlng.lat;
      document.getElementById('longitude').value = e.latlng.lng;
    }
  });
</script>

{% endblock body %}