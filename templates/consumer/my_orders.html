{% extends 'base.html' %}
{% block head %}
<title>My Orders</title>
{% endblock head %}
{% block body %}

<div class="container mt-5">
    <div class="alert alert-secondary text-center">
        <h3>My Service Requests</h3>
    </div>

    <div class="row row-cols-1 g-4">
        {% for req, provider in orders %}
        <div class="col">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center 
                    {% if req.is_inprogress %}bg-success text-white{% elif req.is_active %}bg-warning text-dark{% else %}bg-secondary text-white{% endif %}">
                    
                    <span><strong>{{ req.service_title }}</strong> ({{ req.service_type }})</span>
                    
                    {% if req.is_inprogress %}
                        <span class="badge bg-light text-success">In Progress</span>
                    {% elif req.is_active %}
                        <span class="badge bg-light text-dark">Pending Bids</span>
                    {% else %}
                        <span class="badge bg-dark">Completed/Closed</span>
                    {% endif %}
                </div>
                
                <div class="card-body">
                    <p class="card-text">{{ req.desc }}</p>
                    <p><strong>Budget:</strong> ${{ req.budget }}</p>

                    {% if req.is_inprogress and provider %}
                        <div class="alert alert-light border">
                            <h5>Provider Details:</h5>
                            <p><strong>Name:</strong> {{ provider.full_name }}</p>
                            <p><strong>Email:</strong> <a href="mailto:{{ provider.email }}">{{ provider.email }}</a></p>
                            
                            <hr>
                            <p class="text-muted small">Work is currently underway. Click below only when the job is done.</p>
                            <a href="{{ url_for('close_order', req_id=req.id) }}" 
                               class="btn btn-danger" 
                               onclick="return confirm('Are you sure the work is finished?');">
                               Mark as Completed
                            </a>
                        </div>
                    {% elif req.is_active %}
                        <div class="text-muted">
                            Looking for providers... <a href="{{ url_for('view_bids', req_id=req.id) }}">Check Bids</a>
                        </div>
                    {% else %}
                         <p class="text-center text-muted"><em>This order is closed.</em></p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock body %}