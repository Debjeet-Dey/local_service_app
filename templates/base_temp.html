<!DOCTYPE html>
<html lang="en" data-bs-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* Optional: Makes the Map dark when in Dark Mode so it doesn't hurt your eyes */
        [data-bs-theme="dark"] .leaflet-layer,
        [data-bs-theme="dark"] .leaflet-control-zoom-in,
        [data-bs-theme="dark"] .leaflet-control-zoom-out,
        [data-bs-theme="dark"] .leaflet-control-attribution {
            filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
        }
    </style>

    {% block head %}
    {% endblock head %}
</head>

<body>
    
    <div class="position-fixed bottom-0 start-0 m-3 z-3">
        <button class="btn btn-outline-secondary rounded-circle shadow p-2" id="bd-theme" type="button" style="width: 45px; height: 45px;">
            <i class="bi bi-moon-stars-fill" id="theme-icon"></i>
        </button>
    </div>

    {% block body %}
    {% endblock body %}

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        (() => {
            'use strict'
            const getStoredTheme = () => localStorage.getItem('theme')
            const setStoredTheme = theme => localStorage.setItem('theme', theme)

            const getPreferredTheme = () => {
                const storedTheme = getStoredTheme()
                if (storedTheme) return storedTheme
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
            }

            const setTheme = theme => {
                document.documentElement.setAttribute('data-bs-theme', theme)
            }

            const updateIcon = (theme) => {
                const icon = document.getElementById('theme-icon');
                const btn = document.getElementById('bd-theme');
                if (theme === 'dark') {
                    icon.className = 'bi bi-sun-fill';
                    btn.classList.replace('btn-outline-secondary', 'btn-outline-light');
                } else {
                    icon.className = 'bi bi-moon-stars-fill';
                    btn.classList.replace('btn-outline-light', 'btn-outline-secondary');
                }
            }

            const currentTheme = getPreferredTheme();
            setTheme(currentTheme);

            window.addEventListener('DOMContentLoaded', () => {
                updateIcon(currentTheme);
                document.getElementById('bd-theme').addEventListener('click', () => {
                    const current = document.documentElement.getAttribute('data-bs-theme');
                    const newTheme = current === 'dark' ? 'light' : 'dark';
                    setStoredTheme(newTheme);
                    setTheme(newTheme);
                    updateIcon(newTheme);
                });
            });
        })()
    </script>
</body>

</html>